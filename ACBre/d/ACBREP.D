BEGIN ACBREP
IF ~!Global("ENDOFBG1","GLOBAL",2)Global("ACBREINPARTY","GLOBAL",1)See(player1)~ THEN BEGIN 0.a
SAY @0
IF ~~ THEN DO ~SetGlobal("ACBREINPARTY","GLOBAL",2)JoinParty()~ EXIT
END

IF ~!Global("ENDOFBG1","GLOBAL",2)Global("ACSTORY","GLOBAL",0)Global("ACBREINPARTY","GLOBAL",2)~ THEN BEGIN KICKOUT.1
SAY @1
++ @2 + KICKOUT.1a
++ @3 + KICKOUT.1b
END

IF ~~ THEN BEGIN KICKOUT.1a
SAY @4
IF ~~ THEN DO ~JoinParty()~ EXIT
END

IF ~~ THEN BEGIN KICKOUT.1b
SAY @5
IF ~~ THEN DO ~SetGlobal("ACBREINPARTY","GLOBAL",3)MoveGlobal("AR6701","ACBRESMI",[851.508])EscapeAreaMove("AC9999",333,333,0)~ EXIT
END

IF ~!Global("ENDOFBG1","GLOBAL",2)Global("ACSTORY","GLOBAL",1)Global("ACBREINPARTY","GLOBAL",2)PartyHasItem("ACIRON")~ THEN BEGIN KICKOUT.2
SAY @6 = @7 = @8
IF ~~ THEN DO ~EraseJournalEntry(@10005)AddJournalEntry(@10006,QUEST)SetGlobal("ACAR6700","LOCALS",2)SetGlobal("ACSTORY","GLOBAL",2)SetGlobal("ACBREINPARTY","GLOBAL",3)SetGlobal("ACBREAGARWANTSHISIRON","LOCALS",4)TakePartyItem("ACIRON")DestroyItem("ACIRON")TakePartyItem("ACBOOK")DestroyItem("ACBOOK")AddexperienceParty(300)MoveGlobal("AR6701","ACBRESMI",[851.508])EscapeAreaMove("AC9999",333,333,0)~ EXIT
END

IF ~!Global("ENDOFBG1","GLOBAL",2)Global("ACSTORY","GLOBAL",1)Global("ACBREINPARTY","GLOBAL",2)!PartyHasItem("ACIRON")~ THEN BEGIN KICKOUT.3
SAY @9
++ @2 + KICKOUT.1a
++ @3 + KICKOUT.3b
END

IF ~~ THEN BEGIN KICKOUT.3b
SAY @10
IF ~~ THEN DO ~EraseJournalEntry(@10005)AddJournalEntry(@10007,QUEST_DONE)SetGlobal("ACBREINPARTY","GLOBAL",3)SetGlobal("ACBREAGARFORGOTHISIRON","LOCALS",6)SetGlobal("ACBREBROKE","GLOBAL",1)~ EXIT
END

IF ~!Global("ENDOFBG1","GLOBAL",2)Global("ACSTORY","GLOBAL",3)Global("ACBREINPARTY","GLOBAL",2)~ THEN BEGIN KICKOUT.4
SAY @11
++ @2 + KICKOUT.4a
++ @12 + KICKOUT.4b
END

IF ~~ THEN BEGIN KICKOUT.4a
SAY @13
IF ~~ THEN DO ~JoinParty()~ EXIT
END

IF ~~ THEN BEGIN KICKOUT.4b
SAY @14
++ @15 DO ~SetGlobal("ACBREINPARTY","GLOBAL",3)~ + KICKOUT.4d
++ @16 + KICKOUT.4c
END

IF ~~ THEN BEGIN KICKOUT.4c
SAY @17
IF ~~ THEN DO ~SetGlobal("ACBREINPARTY","GLOBAL",3)SetGlobal("ACBREBROKE","GLOBAL",1)EscapeAreaDestroy(90)~ EXIT
END

IF ~~ THEN BEGIN KICKOUT.4d
SAY @18
IF ~~ THEN DO ~SetGlobal("ACBREINPARTY","GLOBAL",3)EscapeAreaMove("AR6704",77,979,14)~ EXIT
END

IF ~!Global("ENDOFBG1","GLOBAL",2)Global("ACSTORY","GLOBAL",3)Global("ACBREINPARTY","GLOBAL",3)~ THEN BEGIN REJOIN.STORY3
SAY @19
++ @20 + REJOIN.STORY3Y
++ @21 EXIT
END

IF ~~ THEN BEGIN REJOIN.STORY3Y
SAY @22
IF ~~ THEN DO ~SetGlobal("ACBREINPARTY","GLOBAL",2)JoinParty()~ EXIT
END

IF ~!Global("ENDOFBG1","GLOBAL",2)Global("ACSTORY","GLOBAL",4)Global("ACBREINPARTY","GLOBAL",2)~ THEN BEGIN KICKOUT.5
SAY @23
++ @24 + KICKOUT.5a
++ @25 + KICKOUT.5b
END

IF ~~ THEN BEGIN KICKOUT.5a
SAY @26
IF ~~ THEN DO ~JoinParty()~ EXIT
END

IF ~!Global("ENDOFBG1","GLOBAL",2)Global("ACSTORY","GLOBAL",5)Global("ACBREINPARTY","GLOBAL",2)~ THEN BEGIN KICKOUT.6
SAY @27
++ @2 + KICKOUT.6a
++ @28 + KICKOUT.6b
END

IF ~~ THEN BEGIN KICKOUT.6a
SAY @4
IF ~~ THEN DO ~JoinParty()~ EXIT
END

IF ~~ THEN BEGIN KICKOUT.6b
SAY @29
IF ~~ THEN DO ~SetGlobal("ACBREINPARTY","GLOBAL",3)MoveGlobal("AR6701","ACBRESMI",[851.508])EscapeAreaMove("AC9999",333,333,0)~ EXIT
END

IF ~Global("ACAUDWAITS","GLOBAL",5)!InPartySlot(LastTalkedToBy(),0)~ THEN BEGIN AR2010.1
SAY @30
IF ~~ THEN EXIT
END

IF ~Global("ACAUDWAITS","GLOBAL",5)InPartySlot(LastTalkedToBy(),0)~ THEN BEGIN AR2010.2
SAY @31
++ @32 + AR2010.3
++ @33 + AR2010.4
++ @34 + AR2010.5
END

IF ~~ THEN BEGIN AR2010.6
SAY @35
IF ~~ THEN DO ~SetGlobal("ACAUDWAITS","GLOBAL",6)ClearAllActions()StartCutSceneMode()StartCutScene("ACCUT_10")~ EXIT
END

IF ~~ THEN BEGIN AR2010.7
SAY @36
++ @37 + AR2010.6
++ @38 + AR2010.8
++ @39 + AR2010.9
++ @40 + AR2010.10
END

IF ~~ THEN BEGIN AR2010.8
SAY @41
++ @37 + AR2010.6
++ @42 + AR2010.9
++ @43 + AR2010.10
END

IF ~~ THEN BEGIN AR2010.9
SAY @44
++ @45 + AR2010.6
++ @40 + AR2010.10
END

IF ~~ THEN BEGIN AR2010.10
SAY @46
++ @47 + AR2010.6
++ @39 + AR2010.9
IF ~GLOBALGT("ACBREFRIENDCOUNTER","GLOBAL",10)~ THEN REPLY @48 + AR2010.11a
IF ~GLOBALLT("ACBREFRIENDCOUNTER","GLOBAL",11)~ THEN REPLY @48 + AR2010.11b
END

IF ~~ THEN BEGIN AR2010.11a
SAY @49 = @50
IF ~~ THEN DO ~SetGlobal("ACAUDQUEST","GLOBAL",13)SetGlobal("ACBREBIO","GLOBAL",1)SetGlobal("ACBREBIO","GLOBAL",1)SetGlobal("ACBREINPARTY","GLOBAL",2)JoinParty()~ EXIT
END

IF ~~ THEN BEGIN AR2010.11b
SAY @49 = @51
IF ~~ THEN DO ~SetGlobal("ACAUDQUEST","GLOBAL",13)SetGlobal("ACBREINPARTY","GLOBAL",3)SetGlobal("ACBREBROKE","GLOBAL",1)EscapeAreaDestroy(90)~ EXIT
END

IF ~Global("ACAUDWAITS","GLOBAL",6)~ THEN BEGIN AR2000.1
SAY @52
++ @53 + AR2000.2
++ @54 + AR2000.3
++ @55 + AR2000.4
++ @56 + AR2000.5
END

IF ~~ THEN BEGIN AR2000.2
SAY @57
IF ~~ THEN DO ~SetGlobal("ACAUDWAITS","GLOBAL",7)ClearAllActions()StartCutSceneMode()StartCutScene("ACCUT_11")~ EXIT
END

IF ~~ THEN BEGIN AR2000.3
SAY @58
++ @53 + AR2000.2
++ @54 + AR2000.3
++ @55 + AR2000.4
++ @56 + AR2000.5
END

IF ~~ THEN BEGIN AR2000.4
SAY @59
++ @53 + AR2000.2
++ @54 + AR2000.3
++ @56 + AR2000.5
END

IF ~~ THEN BEGIN AR2000.5
SAY @60
++ @53 + AR2000.2
++ @54 + AR2000.3
++ @55 + AR2000.4
END

IF ~Global("ACAUDQUEST","GLOBAL",13)Global("ACAUDQUESTEND","GLOBAL",0)~ THEN BEGIN QUESTEND
SAY @61
++ @62 DO ~SetGlobal("ACAUDQUESTEND","GLOBAL",1)~ + QUESTEND.1
++ @63 DO ~SetGlobal("ACAUDQUESTEND","GLOBAL",1)~ + QUESTEND.2
END

IF ~~ THEN BEGIN QUESTEND.1
SAY @64
IF ~~ THEN DO ~SetGlobal("ACBREINPARTY","GLOBAL",2)JoinParty()~ EXIT
END

IF ~~ THEN BEGIN QUESTEND.2
SAY @65
IF ~~ THEN DO ~SetGlobal("ACBREINPARTY","GLOBAL",3)EscapeAreaMove("AR0334",648,229,2)~ EXIT
END

IF ~Global("ACBREINPARTY","GLOBAL",3)AreaCheck("AR0334")~ THEN BEGIN CROMJOIN
SAY @66
++ @67 + CROMJOIN.1
++ @68 + CROMJOIN.2
END

IF ~~ THEN BEGIN CROMJOIN.1
SAY @69
IF ~~ THEN DO ~SetGlobal("ACBREINPARTY","GLOBAL",2)JoinParty()~ EXIT
END

IF ~~ THEN BEGIN CROMJOIN.2
SAY @70
IF ~~ THEN EXIT
END

IF ~Global("ENDOFBG1","GLOBAL",2)Global("ACBREINPARTY","GLOBAL",2)~ THEN BEGIN KICKOUTBG2
SAY @71 
++ @72 + KICKOUTBG2.1
++ @73 + KICKOUTBG2.2
END

IF ~~ THEN BEGIN KICKOUTBG2.2
SAY @74
IF ~~ THEN DO ~JoinParty()~ EXIT
END

CHAIN
IF ~~ THEN ACBREP KICKOUT.5b
@75
==BYESLI IF ~InParty("YESLICK")See("YESLICK")!StateCheck("YESLICK",CD_STATE_NOTVALID)~ THEN @76
==ACBREP IF ~InParty("YESLICK")See("YESLICK")!StateCheck("YESLICK",CD_STATE_NOTVALID)~ THEN @77
END
++ @78 + KICKOUT.5a
++ @16 + KICKOUT.5c

CHAIN
IF ~~ THEN ACBREP KICKOUT.5c
@79
==BYESLI IF ~InParty("YESLICK")See("YESLICK")!StateCheck("YESLICK",CD_STATE_NOTVALID)~ THEN @80 DO ~LeaveParty()EscapeAreaDestroy(90)~
==ACBREP IF ~InParty("YESLICK")See("YESLICK")!StateCheck("YESLICK",CD_STATE_NOTVALID)~ THEN @81 DO ~SetGlobal("ACBreBroke","GLOBAL",1)SetGlobal("ACBREEXISTS","GLOBAL",2)SetGlobal("ACBREINPARTY","GLOBAL",3)LeaveParty()EscapeAreaDestroy(90)~
EXIT

CHAIN
IF ~~ THEN ACBREP AR2010.3
@82
==ACBREP IF ~Race(PLAYER1,DWARF)~ THEN @83
==ACBREP IF ~!Race(PLAYER1,DWARF)~ THEN @84
==ACBREP @85
END
++ @86 + AR2010.6
++ @87 + AR2010.7
++ @38 + AR2010.8
++ @88 + AR2010.9
++ @40 + AR2010.10

CHAIN
IF ~~ THEN ACBREP AR2010.4
@89
==ACBREP IF ~Race(PLAYER1,DWARF)~ THEN @83
==ACBREP IF ~!Race(PLAYER1,DWARF)~ THEN @84
==ACBREP @85
END
++ @86 + AR2010.6
++ @87 + AR2010.7
++ @38 + AR2010.8
++ @88 + AR2010.9
++ @40 + AR2010.10

CHAIN
IF ~~ THEN ACBREP AR2010.5
@90
==ACBREP IF ~Race(PLAYER1,DWARF)~ THEN @83
==ACBREP IF ~!Race(PLAYER1,DWARF)~ THEN @84
==ACBREP @85
END
++ @86 + AR2010.6
++ @87 + AR2010.7
++ @38 + AR2010.8
++ @39 + AR2010.9
++ @40 + AR2010.10

CHAIN
IF ~~ THEN ACBREP KICKOUTBG2.1
@91
==ACBREP IF ~Global("ACIKNOWCROM","LOCALS",0)~ THEN @92 DO ~SetGlobal("ACIKNOWCROM","LOCALS",1)SetGlobal("ACAR0334","LOCALS",2)SetGlobal("ACBREINPARTY","GLOBAL",3)EscapeAreaMove("AR0334",648,229,2)~
==ACBREP IF ~GlobalGT("ACIKNOWCROM","LOCALS",0)~ THEN @93 DO ~SetGlobal("ACBREINPARTY","GLOBAL",3)EscapeAreaMove("AR0334",648,229,2)~
END
IF ~~ THEN  EXIT